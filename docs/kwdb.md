# TSBS Supplemental Guide: KWDB-tsbs

KWDB is a distributed multimodal database product designed for AIoT IoT scenarios. It supports the simultaneous 
establishment of temporal and relational databases on the same instance and the fusion processing of multimodal data. 
It has efficient processing capabilities for temporal sequence data, including access to millions of devices, writing of 
millions of data in seconds, and reading of billions of data in seconds. It is characterized by stability, security, 
high availability, and easy operation and maintenance.

This document is a supplement to the main README_zh, detailing the following content:

*Related usage of data query tool (`tsbs_generate_data`).<br>
*Related usage of data import tool (`tsbs_load_kwdb`).<br>
*Related usage of the query execution tool (`tsbs_run_queries_kwdb`).<br>

**This should be read *after* the main README_zh [(supplemental docs)](../README_zh.md).**

## Data format

Data generated by `tsbs_generate_data` for kwdb is serialized in a
"pseudo-CSV" format. Each reading consists of a row, the first item is the operation type represented by 1, 3.

- 3 means write tag values, the format is:
  - `3,table name,ptag name,attribute values`
- 1 means insert data (including data values and ptag value), the format is:
    - `1,ptag name,field count,insert data`


An example for the `cpu-only` use case:

```text
3,cpu,host_0,('host_0','eu-central-1','eu-central-1a','6','Ubuntu15.10','x86','SF','19','1','test')
1,host_0,11,(1451606400000,58,2,24,61,22,63,6,44,80,38,'host_0')
```


---
## `tsbs_generate_data` Additional Flags
```bash
`--use-case="cpu-only" --seed=123 --scale=100 --log-interval="10s"  --timestamp-start="2016-01-01T00:00:00Z" --timestamp-end="2016-02-01T00:00:00Z"  --format="kwdb" --orderquantity=12`
```
#### `-use-case` (type: `string`, default: `cpu-only`)
Currently only supports cpu-only in devops

#### `-scale` (type: `int`)
Number of devices, please note that some queries require specifying more than 10 devices to meet the query requirements

#### `-log-interval` (type: `string`)
Sampling interval time

#### `-timestamp-start` (type: `string`)
Start time of data sampling, default 2016-01-01T00:00:00Z

#### `-timestamp-end` (type: `string`)
End time of data sampling

#### `-format` (type: `string`)
type

#### `-orderquantity` (type: `int`, default: `12`)
Number of devices generated first, for example for 100 devices, format = 12 first generate data from host_0 to host_11, then generate data from host_12 to host_23, and so on

---
## `tsbs_load_kwdb` Additional Flags
```bash
` --file=./data.dat --user=root --pass=1234 --host=127.0.0.1 --port=26257 --insert-type=insert --db-name=benchmark --case=cpu-only --batch-size=1000 --workers=12 --partition=false`
```
### connection related
#### `-user` (type: `string`, default: `root`)
User to connect to kwdb me

#### `-pass` (type: `string`, default: ``)
Password for user connecting to kwdb me

#### `-host` (type: `string`)
Hostname of the kwdb server.

#### `-port` (type: `int`, default: `26257`)
Port of the kwdb server.

#### `-insert-type` (type: `string`)
Optional as `insert, prepare`

#### `-db-name` (type: `string`)
Database name

#### `-case` (type: `string`, default: `cpu-only`)
Currently only supports cpu-only in devops

#### `-batch-size/-preparesize` (type: `int`)
The size of each batch. If --insert-type=prepare, replace --batch-size with --preparesize

#### `-workers` (type: `int`)

The number of concurrent writes, recommend keeping the orderquantity consistent with tsbs_generate_data

#### `-partition` (type: `bool`)
Single node set to false, cluster set to true

---
## `tsbs_generate_queries` Additional Flags
```bash
`--use-case="cpu-only" --seed=123 --scale=100 --query-type="single-groupby-1-8-1" --format="kwdb" --queries=10 --db-name=benchmark  --timestamp-start="2016-01-01T08:00:00Z"  --timestamp-end="2016-01-05T00:00:01Z"`
```
#### `-use-case` (type: `string`, default: `cpu-only`)
Currently only supports cpu-only in devops

#### `-query-type` (type: `string`)
Query statement

##### cpu-only
| Query type            | Description                                                                                                       |
|:----------------------|:------------------------------------------------------------------------------------------------------------------|
| single-groupby-1-1-1  | Simple aggregate (MAX) on one metric for 1 host, every 5 mins for 1 hour                                         |
| single-groupby-1-1-12 | Simple aggregate (MAX) on one metric for 1 host, every 5 mins for 12 hours                                       |
| single-groupby-1-8-1  | Simple aggregate (MAX) on one metric for 8 hosts, every 5 mins for 1 hour                                        |
| single-groupby-5-1-1  | Simple aggregate (MAX) on 5 metrics for 1 host, every 5 mins for 1 hour                                          |
| single-groupby-5-1-12 | Simple aggregate (MAX) on 5 metrics for 1 host, every 5 mins for 12 hours                                        |
| single-groupby-5-8-1  | Simple aggregate (MAX) on 5 metrics for 8 hosts, every 5 mins for 1 hour                                         |
| cpu-max-all-1         | Aggregate across all CPU metrics per hour over 1 hour for a single host                                           |
| cpu-max-all-8         | Aggregate across all CPU metrics per hour over 1 hour for eight hosts                                             |
| double-groupby-1      | Aggregate on across both time and host, giving the average of 1 CPU metric per host per hour for 24 hours         |
| double-groupby-5      | Aggregate on across both time and host, giving the average of 5 CPU metrics per host per hour for 24 hours        |
| double-groupby-all    | Aggregate on across both time and host, giving the average of all (10) CPU metrics per host per hour for 24 hours |
| high-cpu-all          | All the readings where one metric is above a threshold across all hosts                                           |
| high-cpu-1            | All the readings where one metric is above a threshold for a particular host                                      |
| lastpoint             | The last reading for each host                                                                                    |
| groupby-orderby-limit | The last 5 aggregate readings (across time) before a randomly chosen endpoint                                     |


#### `-queries` (type: `int`)
Total number of queries

---
## `tsbs_run_queries_kwdb` Additional Flags
```bash
`--file=./query.dat --host=127.0.0.1 --port=26257 --user=root --pass=1234 -workers=1`
```
#### `-user` (type: `string`, default: `root`)
User to connect to kwdb

#### `-pass` (type: `string`, default: ``)
Password for user connecting to kwdb

#### `-host` (type: `string`)
Hostname of the kwdb server.

#### `-port` (type: `int`, default: `26257`)
Port of the kwdb server.

